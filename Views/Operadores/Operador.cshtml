@using ManteniWeb.Code
@using ManteniWeb.DatosTablas
@using ManteniWeb.ClasesDeDatos
@using ManteniWeb.App_GlobalResources

@model TDatosOperador



@*<script src="~/Scripts/bootstrap-select.min.js"></script>*@
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css" />
<link href="~/Content/DataTables/datatables.min.css" rel="stylesheet" />
<link href="~/Content/DataTables/DataTables-1.12.1/css/dataTables.jqueryui.min.css" rel="stylesheet" />

<link rel="stylesheet" href="~/css/Operador.css" />

@{
    List<Calendario> listaCalendarios = new List<Calendario>();
    List<IdiomaOperador> idiomasOperador = new List<IdiomaOperador>();
    List<TipoAsesorEmpresa> tiposAsesorEmpresas = new List<TipoAsesorEmpresa>();
    List<MotivoContrato> motivosContrato = new List<MotivoContrato>();
    List<ObjetoContrato> objetosContratos = new List<ObjetoContrato>();
    VacacionesOperador vacacionesOperador = new VacacionesOperador();

    if (WebConfigParams.UsarOperadorExtendido)
    {
        listaCalendarios = ViewBag.ListaCalendarios as List<Calendario>;
        idiomasOperador = ViewBag.IdiomasOperador as List<IdiomaOperador>;
        tiposAsesorEmpresas = ViewBag.TipoAsesorEmpresa as List<TipoAsesorEmpresa>;
        motivosContrato = ViewBag.TipoMotivoContrato as List<MotivoContrato>;
        objetosContratos = ViewBag.ObjetoContrato as List<ObjetoContrato>;
        vacacionesOperador = ViewBag.VacacionesOperador as VacacionesOperador;
    }

    string title = "";
    if (Model.Codigo != "0")
    {
        title = ComunResources.usuario + " " + Model.Alias;
    }
    else
    {
        title = ComunResources.btn_nuevo + " " + ComunResources.usuario;
    }
}

<div class="jumbotron fix-panel">
    <div class="container">
        <h2 class='tituloGrande visible-lg visible-md' style="font-family: inherit;">
            <i class='fa fa-th' aria-hidden="true"></i>
            <span style='margin-left: 1em;'>@title</span>
        </h2>
    </div>
</div>


@Html.AntiForgeryToken();

<input type="hidden" id="CodigoOperador" value="@Model.Codigo" />
<input type="hidden" id="accionBorrado" value="" />
<input type="hidden" id="tipoModal" value="" />

<div class="container-fluid">
    <div class="row rowSeparacion25">
        @Html.Partial("MenuLateralOperador")

        <div class="col-gl-8 col-sm-8 col-md-8">

            <div class='row rowSeparacion15'>
                <div class='col-lg-1 col-md-1'></div>
                <div class='col-lg-6 col-md-6'>
                    <div id="alerta" class="alert" style="display:none">
                        <a href="#" onclick="CloseAlert();" style="float: right;"><strong> X </strong></a>
                        <p id="alert-mensaje"></p>
                    </div>
                </div>
            </div>



            @*            @using (Html.BeginForm("GuardarDatos", "Operadores", FormMethod.Post, new { id = "formDatosOperador", enctype = "multipart/form-data" }))
            *@
            <form id="formDatosOperador" enctype="multipart/form-data">

                <div class=" rowSeparacion25">
                    <ul class="nav nav-tabs" role="tablist">
                        <li class="active ms-hover" role="presentation">
                            <a href="#datosOperador" aria-controls="datosOperador" role="tab" data-toggle="tab">@ComunResources.datosOperador</a>
                        </li>
                        @if (WebConfigParams.UsarOperadorExtendido)
                        {
                            <li class="ms-hover" role="presentation">
                                <a href="#extendidos" aria-controls="extendidos" role="tab" data-toggle="tab">@ComunResources.otrosDatos</a>
                            </li>
                            <li class="ms-hover" role="presentation">
                                <a href="#calendario" aria-controls="calendario" role="tab" data-toggle="tab">@ComunResources.st_calendario</a>
                            </li>
                        }
                        <li class="ms-hover" role="presentation">
                            <a href="#skillsOperador" aria-controls="skillsOperador" role="tab" data-toggle="tab">Skills</a>
                        </li>
                    </ul>
                </div>
                <div class="tab-content ">
                    @Html.Partial("PanelDatosOperador")

                    @if (WebConfigParams.UsarOperadorExtendido)
                    {
                        @Html.Partial("PanelDatosExtendidos")

                        @Html.Partial("PanelCalendario")
                    }

                    @Html.Partial("PanelSkillsOperador")
                </div>

                <div class="row rowSeparacion20 main">
                    <div class='col-lg-1 col-md-1'></div>
                    <div class="col-lg-10 col-sm-10">
                        <div class="floatRight">
                            <button type="button" class="btn btn-default botonFicha" id="BotonAceptar" onclick="GuardarDatos(0)">@ComunResources.btn_guardar</button>
                            <button type="button" class="btn btn-default botonFicha" id="BotonAceptarSalir" onclick="GuardarDatos(1)">@ComunResources.btn_guardarSalir</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        @if (WebConfigParams.UsarOperadorExtendido)
        {
            <div class="col-gl-2 col-sm-2 col-md-2">
                <div class="sidenav">
                    <div class="card" style='padding: 0px 5px 15px 5px;'>
                        <img id="imageFoto" class="recuadro-foto" src="~/Operadores/CargaFoto/@Model.Codigo" alt="Foto">
                        <div class="container" style="align-items: center;">
                            <button type="button" class="btn btn-default boton-cambiar-foto" onclick="CambiarFoto()" style=" padding-left: 4px; padding-right: 4px;">
                                <span class='fa fa-edit'></span>
                            </button>
                            <button type="button" class="btn btn-default boton-cambiar-foto" onclick="EliminarFoto()" style=" padding-left: 4px; padding-right: 4px;">
                                <span class='fa fa-trash-o' style="color: darkred;"></span>
                            </button>
                        </div>
                        <div style="visibility: hidden;">
                            <input type="file" id="ficheroFoto" name="ficheroFoto" accept="image/png, image/gif, image/jpeg" />
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>


<div class="modal fade modal-center" id="miModal" tabindex="-1" role="dialog" aria-labelledby="miModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="width:800px !important">
        <div class="modal-content">
            <div class="modal-header" id="miModalHeader">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="miModalTitle">Modal title</h4>
            </div>
            <div class="modal-body" id="miModalBody">
                <div id="contenido-body">

                </div>
            </div>
            <div class="modal-footer" id="miModalFooter">
                <button type="button" class="btn btn-info" id="MiModalBotonAceptar" onclick="MiModalAceptar()">Aceptar</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Salir</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


@section scripts {
    @*<script src='~/Scripts/bootstrap-select.js' type='text/javascript'></script>
        <script src="~/Content/Datatables/Select-1.4.0/js/select.bootstrap.min.js"></script>*@
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script src="~/Content/DataTables/DataTables-1.12.1/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="~/js/sweetalert2/dist/sweetalert2.all.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-http-backend@1.3.1/i18nextHttpBackend.min.js"></script>
    <script src="~/js/i18next/i18next.min.js" type="text/javascript"></script>
    <script src="~/js/Operador.js"></script>
    <script src="~/js/ModalOperadores.js"></script>
    <script>

        class DatoComunSelect {
            constructor(id, nombre, accion) {
                this.id = id;
                this.nombre = nombre;
                this.accion = accion;   // Acciones posibles (A)alta y  (B) baja
            }
        }

        let g_calendarios;
        let g_vacaciones;
        let g_idiomasOperador;
        let g_tiposAsesorEmpresas;
        let g_motivosContrato;
        let g_objetosContratos;
        let g_DiasSinServicio = new Array();
        let g_operadorExtendido = false;

        document.addEventListener("DOMContentLoaded", function () {

            let language = '@WebConfigParams.AppLanguage';

            i18next.use(i18nextHttpBackend).init({
                lng: language,
                debug: true,
                fallbackLng: "en",
                backend: {
                    loadPath: '../../locales/{{lng}}.json'
                }
            });

            $('#aliasOp').on('change', function () {
                const esAlta = $('#operadorId').val() === '0'
                var opAlias = $('#aliasOp').val();
                if (esAlta && $('#loginOp').val() === '')
                    $('#loginOp').val(opAlias);
                if (esAlta && $('#nombreOp').val() === '')
                    $('#nombreOp').val(opAlias);
                if ($('#ldapOp').val() === '' && esAlta)
                    $('#ldapOp').val(opAlias);
                if ($('#aliaschatOp').val() === '' && esAlta)
                    $('#aliaschatOp').val(opAlias);
            });
            $('#comboIdiomas').selectpicker();

            CargaOperadoreSkills();
            g_operadorExtendido = @Html.Raw(WebConfigParams.UsarOperadorExtendido.ToString().ToLower());

            if (g_operadorExtendido) {
                CargaVariablesGlobales();
                CargaComboIdiomas();

                tablecal = $('.display').DataTable({
                    "dom": '',
                    "ordering": false
                });


                $('#horarioTable').css('display', 'table');
                $('#diasEspecialesTable').css('display', 'table');

                RellenaDatosCalendarioTablas();

                $('#ficheroFoto').on('change', function () {
                    if (this.files && this.files[0]) {
                        var reader = new FileReader();
                        reader.onload = function (e) {
                            $('#imageFoto').attr('src', e.target.result);
                        }
                        reader.readAsDataURL(this.files[0]);
                    }
                });
            }
        });

        function CargaVariablesGlobales() {
            g_calendarios = @Html.Raw(Json.Encode(listaCalendarios));
            g_idiomasOperador = @Html.Raw(Json.Encode(idiomasOperador));
            g_vacaciones = @Html.Raw(Json.Encode(vacacionesOperador.Vacaciones));

            let tiposAsesorEmpresas = @Html.Raw(Json.Encode(tiposAsesorEmpresas));
            let motivosContrato = @Html.Raw(Json.Encode(motivosContrato));
            let objetosContratos = @Html.Raw(Json.Encode(objetosContratos));

            // paso los datos que se usan en los combos a una clase comun ya que luego se usan en una finción común.
            g_tiposAsesorEmpresas = new Array();
            for (let i = 0; i < tiposAsesorEmpresas.length; i++) {
                const ta = tiposAsesorEmpresas[i];
                g_tiposAsesorEmpresas.push(new DatoComunSelect(ta.TipoAsesosEmpresaId, ta.TipoAsesorEmpresaDesc,''));
            }

            g_objetosContratos = new Array();
            for (let i = 0; i < objetosContratos.length; i++) {
                const oc = objetosContratos[i];
                g_objetosContratos.push(new DatoComunSelect(oc.ObjetoContratoId, oc.ObjetoContratoDesc, ''));
            }

            g_motivosContrato = new Array();
            for (let i = 0; i < motivosContrato.length; i++) {
                const mc = motivosContrato[i];
                g_motivosContrato.push(new DatoComunSelect(mc.MotivoContratoId, mc.MotivoContratoDesc, ''));
            }
        }

    </script>
}
