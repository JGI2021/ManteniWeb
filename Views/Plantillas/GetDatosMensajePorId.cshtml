

@using ManteniWeb.DatosTablas;
@using ManteniWeb.App_GlobalResources;
@using ManteniWeb.ClasesDeDatos;

@model DatosMensajeRecurrenteGrupos

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css" />
<link href="~/Content/DataTables/datatables.min.css" rel="stylesheet" />
<link href="~/Content/DataTables/DataTables-1.12.1/css/dataTables.jqueryui.min.css" rel="stylesheet" />
<link href="~/css/AdmChatComun.css" rel="stylesheet" />


@{
    string title = ConfigResources.mensajecrrente;

    List<IdiomaOperador> listadoIdiomas = ViewBag.ListadoIdiomas as List<IdiomaOperador>;
    List<RegistroNombreId> lsGruposACD = ViewBag.LsGruposACD as List<RegistroNombreId>;

}


<link href="~/css/PlantillasMensajes.css" rel="stylesheet" />


<input type="hidden" id="idsSeleccionados" value="" />

<div class="jumbotron fix-panel">
    <div class="container">
        <h2 class='tituloGrande visible-lg visible-md' style="font-family: inherit;">
            <i class='fa fa-hashtag' aria-hidden="true"></i>
            <span style='margin-left: 1em;'>@title</span>
        </h2>
    </div>
</div>


<div class="container-fluid">
    <div class="row rowSeparacion25">

        <div class="col-lg-2 col-md-2">
            @Html.Partial("MenuRegistros")
        </div>

        <div class="col-lg-8 col-md-8">
            <form id="formDataMensajeria" enctype="multipart/form-data">
                @Html.AntiForgeryToken()

                <div class='row rowSeparacion15'>                    
                    <div class='col-lg-6 col-md-6'>
                        <div id="alerta" class="alert" style="display:none">
                            <a href="#" onclick="CloseAlert();" style="float: right;"><strong> X </strong></a>
                            <p id="alert-mensaje"></p>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6 col-md-6 caja-datos">
                        <div class="row rowSeparacion25">
                            <div class="col-lg-8 col-md-8">
                                <label for="operadorId">@ComunResources.alias <span class="red-text"> * </span></label>
                                <input type="text" id="aliasMensaje" class="form-control datosMensaje" name="Alias" value="@Model.Alias" maxlength="49" onchange="ModificaCampoComando()" />
                            </div>
                        </div>
                        <div class="row rowSeparacion25">
                            <div class="col-lg-8 col-md-8">
                                <label for="operadorId">@ConfigResources.comandoMensajeria <span class="red-text"> * </span></label>
                                <input type="text" id="comando" class="form-control datosMensaje" name="Alias" value="@Model.Comando" maxlength="50" />
                            </div>
                        </div>

                        <div class="row rowSeparacion25">

                            <div class="col-lg-4 col-md-4">
                                <label for="mensajeActivo">@ComunResources.estado</label>
                                <select id="mensajeActivo" class="form-control datosMensaje" name="Activo">
                                    @if (Model.Activo == "1")
                                    {
                                        <option value="1" selected="selected">@ComunResources.chk_activo</option>
                                    }
                                    else
                                    {
                                        <option value="1">@ComunResources.chk_activo</option>
                                    }
                                    @if (Model.Activo == "0")
                                    {
                                        <option value="0" selected="selected">@ComunResources.chk_inactivo</option>
                                    }
                                    else
                                    {

                                        <option value="0">@ComunResources.chk_inactivo</option>
                                    }
                                </select>
                            </div>

                            <div class="col-lg-4 col-md-4">
                                <label for="mensajeIdioma">@ComunResources.lenguaje</label>
                                <select id="mensajeIdioma" class="form-control datosMensaje" name="Language">
                                    @foreach (IdiomaOperador idioma in listadoIdiomas)
                                    {
                                        if (idioma.ISOIdioma.ToLower() == Model.Language.ToLower())
                                        {
                                            <option value="@idioma.ISOIdioma" selected="selected">@idioma.Idioma</option>
                                        }
                                        else
                                        {
                                            <option value="@idioma.ISOIdioma">@idioma.Idioma</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="row rowSeparacion25">
                            <div class="col-lg-12 col-md-12">
                                <label for="mensajeRec">@ConfigResources.mensajecrrente <span class="red-text"> * </span></label>
                                <textarea id="mensajeRec" class="form-control datosMensaje" name="Mensaje" maxlength="1900" rows="5">@Model.Mensaje </textarea>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 caja-datos" style="margin-left:30px;">
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <h4>
                                    <strong>@ComunResources.pr_grupos ACD</strong>
                                    <button type="button" class="my-btn-small btn-primary" onclick="AltaGruposACD()" style="float:right;"><span class="fa fa-plus"></span></button>
                                </h4>
                                <hr />
                                <ul style="display: block; list-style-type: none;" id="listaGruposACD">
                                    @foreach (RegistroNombreId item in Model.GruposACD)
                                    {
                                        <li id="gr_@item.Id" class="liGrupo">
                                            <a onclick="AvanzarPagina();" class="hipervinculoAzul" style="margin-right: 20px;cursor: pointer;">@item.Nombre</a>
                                            <button  type="button" style="padding: 4px 5px; border: none; background-color: inherit; cursor: pointer;" onclick="EliminarGrupo(@item.Id)">
                                                <span class="fa fa-trash-o" style="color:darkred;cursor: pointer;" ></span>
                                            </button>
                                        </li>
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row rowSeparacion20 main">
                    <div class="col-lg-6 col-sm-6">
                        <div class="floatRight">
                            <button type="button" class="btn btn-default botonFicha" id="BotonAceptar" onclick="GuardarDatos(0)">Guardar</button>
                            <button type="button" class="btn btn-default botonFicha" id="BotonAceptarSalir" onclick="GuardarDatos(1)">Guardar y salir</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

      
    </div>
</div>



@Html.Partial("AgregarGruposDialog")


@section scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
    <script src="~/Content/DataTables/DataTables-1.12.1/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script src="~/js/sweetalert2/dist/sweetalert2.all.min.js"></script>
    <script src="~/js/MensajesRec.js" type="text/javascript"></script>

    <script>
        //const { default: i18next } = require("../../node_modules/i18next/index");

        let g_mensajeRecurrente = null;
        let g_gruposACD = [];

        $(function () {

            g_mensajeRecurrente = @Html.Raw(Json.Encode(Model));

            g_gruposACD = @Html.Raw(Json.Encode(lsGruposACD));


            $('#tablaGrupos').DataTable({
                "order": [[2,'asc']],
                "autoWidth": false,
                "language": {
                    "loadingRecords": "&nbsp;",
                    "processing": "@ComunResources.cargando ...",
                    "lengthMenu": "Registros _MENU_ @ComunResources.porPagina",
                    "zeroRecords": "@ComunResources.sinRegistros",
                    "info": "@ComunResources.pagina _PAGE_ de _PAGES_",
                    "infoEmpty": "@ComunResources.sinRegistros",
                    "infoFiltered": "",
                    "search": "@ComunResources.btn_buscar",
                    "paginate": {
                        "first": "@ComunResources.primer",
                        "next": "@ComunResources.siguiente",
                        "previous": "@ComunResources.previo",
                        "last": "@ComunResources.ultima"
                    }
                },
                "lengthMenu": [[5, 10, 15, 25, 50, 100, -1], [5, 10, 15, 25, 50, 100, "@ComunResources.todos"]],
                "pageLength": 15
            });

            $(".datosMensaje").on("change", function () {
                const id = this.id;

                switch (id) {
                    case "aliasMensaje":
                        g_mensajeRecurrente.Alias = $("#" + id).val();
                        if ($("#comando").val() === '') {
                            let comando = $('#aliasMensaje').val();
                            // le quito los espacios
                            comando = comando.replace(/ /g, "");
                            $("#comando").val('#' + $("#" + id).val());
                        }
                        break;
                    case "comando":
                        g_mensajeRecurrente.Comando = $("#" + id).val();
                        break;
                    case "mensajeActivo":
                         g_mensajeRecurrente.Activo = $("#" + id).val();
                        break;
                    case "mensajeIdioma":
                        g_mensajeRecurrente.Language = $("#" + id).val();
                        break;
                    case "mensajeRec":
                        g_mensajeRecurrente.Mensaje = $("#" + id).val();
                        break;
                }

            });
        });

        function ValidaDatos() {
            let aliasMensaje = $('#aliasMensaje').val();
            if (aliasMensaje === undefined || aliasMensaje === null || aliasMensaje.trim() === '') {
                Swal.fire({
                    title: "@ComunResources.atencion",
                    text: "@ComunResources.campoObligatorio: @ComunResources.alias",
                    heightAuto: false,
                    icon: "info"
                });
                return false;
            }

            let comando = $('#comando').val();
            if (comando === undefined || comando === null && comando.trim() === '') {
                Swal.fire({
                    title: "@ComunResources.atencion",
                    text: "@ComunResources.campoObligatorio: @ConfigResources.comandoMensajeria",
                    heightAuto: false,
                    icon: "info"
                });
                return false;
            }

            return true;
        }

        function EliminarGrupo(idGrupo) {
            Swal.fire({
                title: "@ComunResources.btn_eliminar",
                text: "@ComunResources.msg_eliminarRegistroMasContinuar",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#3085d6',
                confirmButtonText: '@ComunResources.btn_eliminar',
                heightAuto: false,
                cancelButtonText: '@ComunResources.btn_cancelar'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire(
                        '@ComunResources.msgeliminado'
                    );

                    const pos = g_mensajeRecurrente.GruposACD.findIndex(gr => gr.Id === idGrupo);
                    if (pos > -1) {
                        g_mensajeRecurrente.GruposACD.splice(pos, 1);
                        $("#gr_" + idGrupo).remove();
                    }

                }
            });
        }


    </script>
}

