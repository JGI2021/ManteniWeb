@model  ManteniWeb.Models.Organizacion

@using ManteniWeb.Models;


@{
    ViewBag.Title = "Asignar organizaciones";
    List<NivelesOrganizacion> niveles = (List<NivelesOrganizacion>)ViewBag.NivelesOrganizacion;
    int AdministrarOrganizacion = (int)ViewBag.AdministraOrganizacion;
    int hayError = Convert.ToInt32(@Model.HayError);
    int hayMensaje = Convert.ToInt32(@Model.HayMensaje);
}

<link href="~/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/Content/bootstrap-select.min.css" rel="stylesheet" />
<link href="~/css/MyTreeView.css" rel="stylesheet" />
<link href="~/css/Organizacion.css" rel="stylesheet" />
<link href="~/css/AsignarOrganizacion.css" rel="stylesheet" />

<style>
    html {
        scroll-behavior: smooth;
    }

    hr {
        margin-top: 15px !important;
        border-top: 1px solid #c2c2c2 !important;
    }

    nav.navbar {
        position: fixed !important;
        width: 100% !important;
    }

    .margin70 {
        margin-top: 70px;
    }
</style>

<script src="~/Scripts/bootstrap-select.min.js"></script>
<script src="~/js/AsignarOrganizacion.js"></script>

<script src="~/js/sweetalert2/dist/sweetalert2.all.min.js" type="text/javascript"></script>

        @*<div class="jumbotron" style="padding:0px;margin-bottom:0px">
        <div class='container'>
            <h2 class='tituloGrande visible-lg visible-md' style="font-family: inherit;">
                <i class='fa fa-th' aria-hidden="true"></i>
                <span style='margin-left: 1em;'>@ViewBag.Title</span>
            </h2>
        </div>
    </div>*@



@Html.AntiForgeryToken();

<div style="height:70px;"></div>
<div class="container-fluid" style="overflow-y: auto; height: 85vh;">
    @*CAMPO OCULTO PARA LOS NODOS SELECCIONADOS Y PARA COORDINADORES SELECCIONADOS*@
    @*<input type="hidden" id="NodosSeleccionados" value="" />*@
    <input type="hidden" id="CoordinadoresSeleccionados" value="" />
    <input type="hidden" id="AministraOrganizacion" value="@AdministrarOrganizacion" />


    <div class="row ">
        @* Panel izquierdo, donde se coloca el menú *@
        <div class="col-lg-2 col-md-2 col-sm-2" style='text-align:left;' collapse width show" id="LeftPanel">
            <div class="panelMenuFijar">
                <h4>
                    <i class='fa fa-th' aria-hidden="true"></i>
                    <b><span style='margin-left: 1em;'>@ViewBag.Title</span></b>
                </h4>
                <hr />
                @Html.Partial("_MenuVolver")

                <div class="row no-display panelFijo">
                    <div class="col-lg-12">
                        <h3 style="font-weight:600;">Coordinadores</h3>
                        <hr />
                        <ul id="listadoCoordinadores" style="font-size:16px;padding-left:30px;">
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- FIN PANEL IZQUIERDO -->
        <!-- Solo entran los que tienen nivel jerárquico -->
        @if (AdministrarOrganizacion >= 0)
        {
            <!--- PANEL DERECHO -->
            <!-- SE MUESTRA LA ORGANIZACION -->

            <div class="col-lg-4 col-md-4" id="MostrarModelo" style="overflow-y: auto;">
                @Html.Partial("_ModeloOrganizacion", Model)
            </div>
            <!-- FIN MOSTRAR ORGANIZACION-->
            <!-- PANEL DE ALTAS, ASIGNACIONES y BAJAS DE NODOS -->
            <div class="col-lg-6 col-md-6" style="overflow-y: auto;">
                <!-- BOTONERA DE ACCIONES -->
                <!-- FIN BOTONERA DE ACCIONES -->
                <!-- PANEL DE ACCIONES -->
                <div class="row  panel-opciones-crear">
                    <div class="panel panel-default no-visible" id="panelAcciones" style="height:100%;">
                        <div class="panel-heading  panel-head" id="panelcabecera">
                            <a data-toggle="collapse" href="#test" class="close" onclick="CerrarPanel('panelAcciones');"><span class="fa fa-close"></span></a>
                            <h4 class="panel-head" id="panel-title"></h4>
                        </div>
                        <div class="panel-body" id="panel-body">

                            <form method="post" action="@Url.Action("ModeloOrganizacion", "Organizacion")">
                                <input type='hidden' id='accion' name='accion' value='' />

                                @{
                                    string idorganiz = "0";
                                    if (niveles.Count > 0)
                                    {
                                        idorganiz = (niveles[niveles.Count - 1]).IdNivelOrganizacion.ToString();
                                    }
                                }
                                <input type="hidden" id="IdNodoAsesores" value="@idorganiz" />

                                <div class="row rowSeparacion15">
                                    <div class="col-lg-12 col-md-12">
                                        <label for="select-nivel">Seleccionar tipo </label>
                                        <select class="form-control selectpicker" id="select-nivel" name="selectnivel" required
                                                title="Selecciona tipo de organización"
                                                onchange="CargaNodosPadre();">
                                            @* Salvo que tenga el orden=1 solo permito hacer cosas sobre un nivel inferior *@

                                            @{
                                                int minAcceso = 99;
                                                if (niveles.Count > 0)
                                                {
                                                    minAcceso = niveles[0].Orden == 1 ? niveles[0].Orden : niveles[0].Orden + 1;
                                                }
                                            }

                                            @foreach (NivelesOrganizacion nivel in niveles)
                                            {
                                                if (minAcceso <= nivel.Orden)
                                                {
                                                    if (nivel.TablaTiphone != "OP_TABLE" && nivel.Orden != 1)  // Solo puede haber uno de nivel 1.					  
                                                    {
                                                        <option value="@nivel.IdNivelOrganizacion">@nivel.Nombre</option>
                                                    }
                                                }
                                            }
                                        </select>

                                    </div>


                                </div>
                                <div class="row rowSeparacion15">
                                    <div class="col-lg-12 col-md-12" id="panelNombreOrganizacion">
                                        <label for="nombreOrganizacion">Nombre </label>
                                        <input type="text" id="nombreOrganizacion" class="form-control" name="nombreOrganizacion" value="" required
                                               placeholder="Introducir un nombre ..." />
                                    </div>
                                </div>
                                <div class="row rowSeparacion15">
                                    <div class="col-lg-12 col-md-12" id="panelNodoPadre">
                                        <div class="form-group">
                                            <label for="select-padre">Organización padre </label>
                                            <select class="form-control selectpicker" id="select-padre" name="nodoPadre" required
                                                    onchange="BuscarNodosHijos()"
                                                    title="Selecciona el nodo padre ...">
                                                <option value="0"> RAIZ </option>
                                            </select>
                                        </div>
                                    </div>

                                </div>

                                <div class="row " style="text-align:right ;margin-right: 25px;">
                                    <button type="button" id="btn-guardar" class="btn btn-info" onclick="GuardarCambios();">Guardar</button>
                                    <button type="button" class="btn btn-default" onclick="CerrarPanel('panelAcciones');">Salir</button>
                                </div>

                            </form>
                        </div>
                    </div>
                </div>

                <div class="row  no-display " id="panelDeCoordinadores">
                    @* PANEL COORDINADORES *@
                    @Html.Partial("~/Views/Organizacion/PanelAccionCoordinadores.cshtml")
                </div>

                <div class="row  panel-opciones-update no-display" id="panelAccionUpdate">
                    @* PANEL Update *@
                    @Html.Partial("~/Views/Organizacion/PanelAccionUpdate.cshtml")
                </div>

                <div class="row  no-display" id="panelOperadores">
                    @* PANEL Operadores *@
                    @Html.Partial("~/Views/Organizacion/PanelAsesores.cshtml")

                </div>

            </div>
        }
    </div>
</div>
